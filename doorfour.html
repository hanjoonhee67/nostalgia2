<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì—­ ì°¾ê¸° ê²Œì„ - ìº¡ì±  ê¸¸ì°¾ê¸°</title>
<link href="https://fonts.googleapis.com/css2?family=Orbit:wght@400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  width:100vw;height:100vh;
  overflow:hidden;
  background:url('road.png') center/cover no-repeat;
  font-family:"Orbit";
  cursor:none;
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ë°°ê²½ ì „í™˜ìš© ë ˆì´ì–´ */
#background-overlay{
  position:fixed;
  inset:0;
  background:url('road2.png') center/cover no-repeat;
  opacity:0;
  transition:opacity 1s ease-in-out;
  z-index:-1;
  pointer-events:none;
}

#background-overlay.show{
  opacity:1;
}

/* ì„¸ ë²ˆì§¸ ë°°ê²½ ì „í™˜ìš© ë ˆì´ì–´ */
#background-overlay-2{
  position:fixed;
  inset:0;
  background:url('road3.png') center/cover no-repeat;
  opacity:0;
  transition:opacity 1s ease-in-out;
  z-index:-1;
  pointer-events:none;
}

#background-overlay-2.show{
  opacity:1;
}

/* ìŒì•… í”Œë ˆì´ì–´ - ìœˆë„ìš° ì°½ ìŠ¤íƒ€ì¼ */
#music-player{
  position:fixed;
  top:120px;
  right:100px;
  z-index:200;
  background:#C0C0C0;
  border:3px outset #C0C0C0;
  padding:0;
  box-shadow:inset 1px 1px 0px #000, inset -1px -1px 0px #fff, 2px 2px 4px rgba(0,0,0,0.3);
  font-family:"MS Sans Serif", "Segoe UI", sans-serif;
  min-width:200px;
}

#music-player-title{
  background:#000080;
  color:#fff;
  font-size:0.75rem;
  margin:0;
  padding:3px 6px;
  text-align:left;
  font-weight:normal;
  border-bottom:2px solid #000;
}

#music-player-content{
  padding:8px;
  display:flex;
  align-items:center;
  gap:8px;
}

#music-toggle{
  background:#C0C0C0;
  border:2px outset #C0C0C0;
  color:#000;
  padding:3px 12px;
  cursor:pointer;
  font-size:0.7rem;
  font-family:"MS Sans Serif", "Segoe UI", sans-serif;
  min-width:50px;
}

#music-toggle:active{
  border:2px inset #C0C0C0;
}

#volume-control{
  display:flex;
  align-items:center;
  gap:5px;
  font-size:0.7rem;
  color:#000;
}

#volume-slider{
  width:70px;
  height:4px;
  background:#C0C0C0;
  border:1px inset #C0C0C0;
  outline:none;
  cursor:pointer;
}

#volume-slider::-webkit-slider-thumb{
  appearance:none;
  width:10px;
  height:10px;
  background:#C0C0C0;
  border:1px outset #C0C0C0;
  cursor:pointer;
}

#volume-slider::-moz-range-thumb{
  width:10px;
  height:10px;
  background:#C0C0C0;
  border:1px outset #C0C0C0;
  cursor:pointer;
}

/* ì±•í„° í‘œì‹œ */
#chapter-label{
  position:fixed;
  top:30px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:1.2rem;
  font-weight:bold;
  font-family:"Orbit", sans-serif;
  z-index:200;
  text-shadow:0 2px 10px rgba(0,0,0,0.5);
  letter-spacing:3px;
}

/* í”„ë ˆì„ ì´ë¯¸ì§€ */
#web-frame{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  object-fit:cover;
  z-index:9999;
  pointer-events:none;
}

/* ìœˆë„ìš° ë…¸ì´ì¦ˆ íš¨ê³¼ */
#window-noise{
  position:fixed;
  inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  opacity:0.15;
  pointer-events:none;
  z-index:10000;
  mix-blend-mode:overlay;
  animation:noiseFlicker 0.1s infinite;
}

@keyframes noiseFlicker{
  0%,100%{opacity:0.1;}
  50%{opacity:0.2;}
}

/* ìŠ¤ìº”ë¼ì¸ íš¨ê³¼ */
#scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 2px,
    rgba(0,0,0,0.1) 2px,
    rgba(0,0,0,0.1) 4px
  );
  pointer-events:none;
  z-index:10001;
}

/* ê²€ì€ ì˜¤ë²„ë ˆì´ - ëˆˆì„ ëœ¨ëŠ” ê²ƒì²˜ëŸ¼ í˜ì´ë“œì•„ì›ƒ */
#black-overlay{
  position:fixed;
  inset:0;
  background:#000;
  z-index:1000;
  pointer-events:none;
  animation:fadeOutEyes 2s ease-out forwards;
}

@keyframes fadeOutEyes{
  0%{opacity:1;}
  100%{opacity:0;}
}

/* íŒŒë€ Error í™”ë©´ ì˜¤ë²„ë ˆì´ */
#error-overlay{
  position:fixed;
  inset:0;
  background:#0000aa;
  opacity:0.4;
  z-index:1;
  pointer-events:none;
  transition:opacity 1s;
}
#error-overlay.fade-out{
  opacity:0;
}

/* ìŠ¤í”¼ì»¤ ë¼ë²¨ */
#speaker-label{
  position:fixed;
  bottom:210px;
  left:50%;
  transform:translateX(-50%);
  margin-left:-280px;
  background:rgba(0,0,100,0.85);
  color:white;
  padding:8px 16px;
  border-radius:8px;
  font-size:0.9rem;
  font-weight:bold;
  text-transform:uppercase;
  z-index:100;
  pointer-events:none;
  font-family:"Orbit", sans-serif;
  opacity:0;
  transition:opacity 0.3s;
}
#speaker-label.show{opacity:1;}

/* ìë§‰ë°” */
#subtitle-box{
  position:fixed;
  bottom:90px;
  left:50%;
  transform:translateX(-50%);
  width:600px;
  max-width:90%;
  background:rgba(0,0,0,0.6);
  padding:20px 30px;
  z-index:100;
  cursor:pointer;
  transition:background 0.3s, opacity 0.3s;
  min-height:80px;
  display:flex;
  align-items:center;
  border-radius:10px;
  backdrop-filter:blur(5px);
  opacity:0;
  pointer-events:none;
}
#subtitle-box.show{
  opacity:1;
  pointer-events:auto;
}
#subtitle-box:hover{
  background:rgba(0,0,0,0.75);
}

/* ìë§‰ í…ìŠ¤íŠ¸ */
#subtitle-text{
  color:white;
  font-size:1.1rem;
  line-height:1.6;
  font-family:"Orbit", sans-serif;
  width:100%;
  max-width:90%;
}

/* íƒ€ì´í•‘ ì»¤ì„œ */
#typing-cursor{
  display:inline-block;
  width:2px;
  height:1.2em;
  background:white;
  margin-left:4px;
  animation:blinkCursor 1s infinite;
  vertical-align:middle;
}

@keyframes blinkCursor{
  0%,50%{opacity:1;}
  51%,100%{opacity:0;}
}

#game-container{
  width:80vw;
  height:70vh;
  background:transparent;
  border:none;
  position:relative;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.5s;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
#game-container.show{
  opacity:1;
  pointer-events:auto;
}

#game-instruction{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:1.1rem;
  z-index:10;
  background:rgba(0,0,0,0.75);
  padding:12px 30px;
  border-radius:10px;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.5s;
  text-align:center;
  backdrop-filter:blur(5px);
  font-family:"Orbit", sans-serif;
}
#game-instruction.show{
  opacity:1;
  pointer-events:auto;
}

/* ìƒíƒœ ë©”ì‹œì§€ */
#status-message{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  color:white;
  font-size:1.3rem;
  z-index:10;
  background:rgba(0,0,0,0.75);
  padding:20px 40px;
  border-radius:15px;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.5s;
  text-align:center;
  backdrop-filter:blur(5px);
}
#status-message.show{
  opacity:1;
  pointer-events:auto;
}

#noise-overlay{
  position:fixed;
  inset:0;
  background:rgba(255,0,0,0.2);
  opacity:0;
  pointer-events:none;
  z-index:100;
  transition:opacity 0.3s;
}

#noise-overlay.show{
  opacity:1;
}

/* ì§€ì§€ì§ íš¨ê³¼ìš© ê°•í•œ ë…¸ì´ì¦ˆ */
#glitch-overlay{
  position:fixed;
  inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  opacity:0;
  pointer-events:none;
  z-index:1500;
  mix-blend-mode:screen;
}

#glitch-overlay.show{
  animation:glitchFlicker 0.6s ease-out forwards;
}

@keyframes glitchFlicker{
  0%{opacity:0; transform:translateX(0);}
  10%{opacity:0.9; transform:translateX(-3px);}
  20%{opacity:0.7; transform:translateX(3px);}
  30%{opacity:0.85; transform:translateX(-2px);}
  40%{opacity:0.6; transform:translateX(2px);}
  50%{opacity:0.8; transform:translateX(-1px);}
  60%{opacity:0.5; transform:translateX(1px);}
  70%{opacity:0.3; transform:translateX(0);}
  100%{opacity:0; transform:translateX(0);}
}

#success-overlay{
  position:fixed;
  inset:0;
  background:rgba(76,255,101,0.3);
  opacity:0;
  pointer-events:none;
  z-index:100;
  transition:opacity 0.5s;
}

#success-overlay.show{
  opacity:1;
}

#success-message{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:rgba(255,255,255,0.95);
  padding:40px 60px;
  border-radius:20px;
  text-align:center;
  z-index:101;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.5s;
  box-shadow:0 10px 50px rgba(0,0,0,0.3);
}

#success-message.show{
  opacity:1;
  pointer-events:auto;
}

#success-message h2{
  font-size:2rem;
  color:#667eea;
  margin-bottom:20px;
}

#success-message p{
  font-size:1.2rem;
  color:#333;
  line-height:1.8;
  margin:10px 0;
}

#station-next-btn{
  margin-top:10px;
  padding:8px 18px;
  border-radius:999px;
  border:none;
  background:#667eea;
  color:#fff;
  font-size:1.1rem;
  cursor:pointer;
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}

#station-next-btn:hover{
  transform:translateY(-1px);
}

/* íŒíŠ¸ í…ìŠ¤íŠ¸ */
#hint{
  position:fixed;
  bottom:30px;left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:1rem;
  z-index:10;
  text-shadow:0 2px 10px rgba(0,0,0,0.5);
  opacity:0;
  transition:opacity 0.5s;
}

/* ì»¤ì„œ ì  */
#cursor-dot{
  position:fixed;
  width:14px;height:14px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,0.9);
  transform:translate(-50%,-50%);
  pointer-events:none;
  z-index:9999;
}

/* ì»¤ì„œ ë”°ë¼ì˜¤ëŠ” ì§‘ ì´ë¯¸ì§€ */
#home-container{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:1000;
}

.home{
  position:absolute;
  width:100px;
  pointer-events:none;
  mix-blend-mode:screen;
  opacity:0.8;
  transition:transform 0.1s ease-out, opacity 0.5s ease-out;
  will-change:transform;
  z-index:1000;
}

/* ìº¡ì±  ëª¨ë‹¬ */
#captcha-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1500;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.3s;
}

#captcha-modal.show{
  opacity:1;
  pointer-events:auto;
  animation:captchaFloat 12s ease-in-out infinite;
}

/* ìº¡ì± ì°½ ì•½í•˜ê²Œ ë– ë‹¤ë‹ˆëŠ” íš¨ê³¼ */
@keyframes captchaFloat{
  0%, 100%{
    transform:translate(0, 0);
  }
  25%{
    transform:translate(-15px, -10px);
  }
  50%{
    transform:translate(10px, -20px);
  }
  75%{
    transform:translate(-10px, 15px);
  }
}

#captcha-box{
  width:60%;
  max-width:450px;
  background:#C0C0C0;
  border:3px outset #C0C0C0;
  padding:0;
  color:#000;
  text-align:center;
  box-shadow:inset 1px 1px 0px #000, inset -1px -1px 0px #fff, 2px 2px 4px rgba(0,0,0,0.3);
  font-family:"MS Sans Serif", "Segoe UI", sans-serif;
  position:relative;
}

#captcha-title{
  background:#000080;
  color:#fff;
  font-size:0.9rem;
  margin:0;
  padding:4px 8px;
  text-align:left;
  font-weight:normal;
  border-bottom:2px solid #000;
}

#captcha-text{
  font-size:0.85rem;
  line-height:1.5;
  margin:15px 20px;
  color:#000;
}

#captcha-image-container{
  margin:10px 20px 15px;
}

#captcha-image-container.single img{
  max-width:100%;
  border:2px inset #C0C0C0;
  box-shadow:inset 1px 1px 2px rgba(0,0,0,0.3);
}

#captcha-image-container.multiple{
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:8px;
}

.captcha-thumb{
  position:relative;
  overflow:hidden;
  border:2px outset #C0C0C0;
  cursor:pointer;
  transition:border 0.1s;
  background:#C0C0C0;
}

.captcha-thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

.captcha-thumb.selected{
  border:2px inset #C0C0C0;
}

.captcha-thumb:active{
  border:2px inset #C0C0C0;
}

#captcha-options{
  margin:15px 20px;
  text-align:center;
}

.captcha-btn{
  display:inline-block;
  margin:0 4px;
  padding:4px 16px;
  border:2px outset #C0C0C0;
  background:#C0C0C0;
  font-size:0.75rem;
  font-family:"MS Sans Serif", "Segoe UI", sans-serif;
  cursor:pointer;
  box-shadow:none;
  min-width:75px;
}

.captcha-btn:active{
  border:2px inset #C0C0C0;
}

.captcha-btn.primary{
  background:#C0C0C0;
  color:#000;
}

.captcha-btn.secondary{
  background:#C0C0C0;
  color:#000;
}

#captcha-error{
  margin:10px 20px;
  color:#000;
  font-size:0.75rem;
  min-height:1.1em;
  background:#FFE4E1;
  padding:4px 8px;
  border:1px inset #C0C0C0;
}
</style>
</head>
<body>

<div id="background-overlay"></div>
<div id="background-overlay-2"></div>
<div id="black-overlay"></div>
<div id="error-overlay"></div>
<img id="web-frame" src="web frame.png" alt="frame">
<div id="window-noise"></div>
<div id="scanlines"></div>
<div id="chapter-label">CHAPTER 4</div>
<div id="music-player">
  <div id="music-player-title">ìŒì•… í”Œë ˆì´ì–´</div>
  <div id="music-player-content">
    <button id="music-toggle">ì¬ìƒ</button>
    <div id="volume-control">
      <span>ğŸ”Š</span>
      <input type="range" id="volume-slider" min="0" max="100" value="50">
    </div>
  </div>
</div>
<audio id="bgmusic" loop>
  <source src="bgmusic.mp3" type="audio/mpeg">
</audio>

<div id="speaker-label">YOU</div>
<div id="subtitle-box">
  <div id="subtitle-text"></div>
</div>

<div id="game-instruction">í´ë¦­í•˜ì—¬ ì—¬ëŸ¬ ì§ˆë¬¸ë“¤ì„ í´ë¦¬ì–´í•˜ì„¸ìš”.</div>
<div id="game-container">
  <div id="status-message"></div>
</div>

<div id="noise-overlay"></div>
<div id="glitch-overlay"></div>
<div id="success-overlay"></div>

<div id="success-message">
  <h2>ê¸°ì°¨ì—­ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.</h2>
  <p id="station-text-1">"ê¸°ì°¨ì—­ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤."</p>
  <p id="final-text" style="display:none; margin-top:20px; font-size:1rem; color:#333;">ì´ì œ ê³ í–¥ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆê² ë„¤ìš”.</p>
  <button id="station-next-btn">&gt;</button>
  <p id="station-text-2" style="display:none;">ë§ˆì§€ë§‰ ë¬¸ì„ ì—´ê³  ì—”ë”©ì„ ë³´ì„¸ìš”.</p>
</div>

<div id="captcha-modal">
  <div id="captcha-box">
    <h2 id="captcha-title"></h2>
    <p id="captcha-text"></p>
    <div id="captcha-image-container"></div>
    <div id="captcha-options"></div>
    <p id="captcha-error"></p>
  </div>
</div>

<div id="hint">í™”ì‚´í‘œ í‚¤ë¡œ í•œ ë¸”ëŸ­ ì´ë™í•´ ë³´ì„¸ìš”</div>
<div id="home-container"></div>
<div id="cursor-dot"></div>

<script>
const noiseOverlay = document.getElementById("noise-overlay");
const glitchOverlay = document.getElementById("glitch-overlay");
const successOverlay = document.getElementById("success-overlay");
const successMessage = document.getElementById("success-message");
const cursor = document.getElementById("cursor-dot");
const homeContainer = document.getElementById("home-container");
const hint = document.getElementById("hint");
const subtitleText = document.getElementById("subtitle-text");
const bgmusic = document.getElementById("bgmusic");
const musicToggle = document.getElementById("music-toggle");
const volumeSlider = document.getElementById("volume-slider");

// ìŒì•… í”Œë ˆì´ì–´ ì œì–´
musicToggle.addEventListener("click", () => {
  if(bgmusic.paused){
    bgmusic.play();
    musicToggle.textContent = "ì •ì§€";
  }else{
    bgmusic.pause();
    musicToggle.textContent = "ì¬ìƒ";
  }
});

volumeSlider.addEventListener("input", (e) => {
  bgmusic.volume = e.target.value / 100;
});
const subtitleBox = document.getElementById("subtitle-box");
const speakerLabel = document.getElementById("speaker-label");
const errorOverlay = document.getElementById("error-overlay");
const gameContainer = document.getElementById("game-container");
const statusMessage = document.getElementById("status-message");
const gameInstruction = document.getElementById("game-instruction");

// ì´ˆê¸° ë©”ì‹œì§€
const messages = [
  "ë„ì„œê´€ê¹Œì§€ ë“¤ë €ë”ë‹ˆ ì‹œê°„ì´ ë„ˆë¬´ ì§€ì²´ëì–ì•„.",
  "ë‚˜ë„ ëª¨ë¥´ê²Œ í¸ì•ˆí•˜ê²Œ ìˆê³  ë§ì•˜ë„¤.",
  "ê·¸ì¹˜ë§Œ...",
  "ë¬˜í•˜ê²Œ ê¸´ì¥ì´ í’€ë¦¬ëŠ”ê±¸...",
  "ë§ˆìŒì´ ì™œì´ëŸ¬ì§€? ì¼ë‹¨ ê¸°ì°¨ì—­ë¶€í„° ë¹¨ë¦¬ ì°¾ì•„ê°€ì•¼ê² ì–´.",
  "í•œ ë¸”ëŸ­ ê°„ í›„ì— ì™¼ìª½ìœ¼ë¡œ êº¾ê³  ë‘ ë¸”ëŸ­ ë” ê°€ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ êº¾ìœ¼ë¼ í–ˆì—ˆì§€?"
];

let currentMessageIndex = 0;
let isTyping = false;
let typingTimeout = null;

// íƒ€ì´í•‘ íš¨ê³¼ í•¨ìˆ˜
function typeText(text, callback){
  // ìµœì¢… ë©”ì‹œì§€ ë‹¨ê³„ì¸ì§€ í™•ì¸
  const isFinalStage = hasDoneTrains && finalMessageIndex >= 0;
  
  if(isFinalStage){
    if(isTypingFinal) return;
    isTypingFinal = true;
  } else {
    if(isTyping) return;
    isTyping = true;
  }
  
  subtitleText.innerHTML = "";
  let charIndex = 0;
  
  function typeChar(){
    if(charIndex < text.length){
      subtitleText.innerHTML = text.substring(0, charIndex + 1) + '<span id="typing-cursor"></span>';
      charIndex++;
      const timeout = isFinalStage ? 
        (finalTypingTimeout = setTimeout(typeChar, 50)) :
        (typingTimeout = setTimeout(typeChar, 50));
    } else {
      subtitleText.innerHTML = text;
      if(isFinalStage){
        isTypingFinal = false;
      } else {
        isTyping = false;
      }
      if(callback) callback();
    }
  }
  
  typeChar();
}

// íŒŒë€ í™”ë©´ í˜ì´ë“œì•„ì›ƒ í›„ ì²« ë©”ì‹œì§€ í‘œì‹œ
setTimeout(() => {
  errorOverlay.classList.add("fade-out");
  setTimeout(() => {
    speakerLabel.classList.add("show");
    subtitleBox.classList.add("show");
    typeText(messages[0]);
  }, 1000);
}, 2100); // ê²€ì€ ì˜¤ë²„ë ˆì´ê°€ ì‚¬ë¼ì§„ í›„

// í…ìŠ¤íŠ¸ ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
subtitleBox.addEventListener("click", () => {
  // ìµœì¢… ë©”ì‹œì§€ ë‹¨ê³„ ì²´í¬
  if(hasDoneTrains && finalMessageIndex >= 0){
    if(isTypingFinal){
      // íƒ€ì´í•‘ ì¤‘ì´ë©´ ì¦‰ì‹œ ì™„ì„±
      clearTimeout(finalTypingTimeout);
      subtitleText.innerHTML = finalMessages[finalMessageIndex];
      isTypingFinal = false;
      return;
    }
    
    finalMessageIndex++;
    
    if(finalMessageIndex < finalMessages.length){
      // ë‹¤ìŒ ë©”ì‹œì§€ íƒ€ì´í•‘
      typeText(finalMessages[finalMessageIndex], () => {
        isTypingFinal = false;
      });
    } else {
      // ë§ˆì§€ë§‰ ë©”ì‹œì§€ í›„ í…ìŠ¤íŠ¸ ë°•ìŠ¤ ì‚¬ë¼ì§€ê³  ì¤‘ì•™ ë©”ì‹œì§€ í‘œì‹œ
      subtitleBox.classList.remove("show");
      speakerLabel.classList.remove("show");
      
      setTimeout(() => {
        // ì¤‘ì•™ ë©”ì‹œì§€ í‘œì‹œ
        statusMessage.textContent = "ë§ˆì§€ë§‰ ë¬¸ì„ ì—´ê³  ì—”ë”©ì„ ë³´ì„¸ìš”.";
        statusMessage.classList.add("show");
        
        // doors.htmlë¡œ ì´ë™
        setTimeout(() => {
          location.href = "doors.html";
        }, 3000);
      }, 500);
    }
    return;
  }
  
  // ì´ˆê¸° ë©”ì‹œì§€ ë‹¨ê³„
  if(isTyping){
    // íƒ€ì´í•‘ ì¤‘ì´ë©´ ì¦‰ì‹œ ì™„ì„±
    clearTimeout(typingTimeout);
    subtitleText.innerHTML = messages[currentMessageIndex];
    isTyping = false;
    return;
  }
  
  currentMessageIndex++;
  
  if(currentMessageIndex < messages.length){
    // ë‹¤ìŒ ë©”ì‹œì§€ íƒ€ì´í•‘
    typeText(messages[currentMessageIndex]);
  } else {
    // ë§ˆì§€ë§‰ ë©”ì‹œì§€ í›„ ê²Œì„ ì‹œì‘
    subtitleBox.classList.remove("show");
    speakerLabel.classList.remove("show");
    setTimeout(() => {
      gameContainer.classList.add("show");
      gameInstruction.classList.add("show");
      hint.style.opacity = "1";
      hint.textContent = "í™”ë©´ì„ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”";
    }, 500);
  }
});

// ìµœì¢… ë²„íŠ¼/í…ìŠ¤íŠ¸
const stationNextBtn = document.getElementById("station-next-btn");
const stationText2 = document.getElementById("station-text-2");

// ìº¡ì±  ìš”ì†Œë“¤
const captchaModal = document.getElementById("captcha-modal");
const captchaTitle = document.getElementById("captcha-title");
const captchaText = document.getElementById("captcha-text");
const captchaImgContainer = document.getElementById("captcha-image-container");
const captchaOptions = document.getElementById("captcha-options");
const captchaError = document.getElementById("captcha-error");

// ì§‘ ì•„ì´ì½˜ ë”°ë¼ì˜¤ê¸°
const homeImgs = ['home2.png', 'home.png'];
let lastCreateTime = 0;

function createHomeImage(x, y){
  const img = document.createElement('img');
  img.src = homeImgs[Math.floor(Math.random() * homeImgs.length)];
  img.className = 'home';
  img.style.left = x + 'px';
  img.style.top = y + 'px';

  if(Math.random() > 0.5){
    img.style.width = '80px';
    img.style.opacity = '0.6';
    img.style.filter = 'blur(1.5px)';
  }

  homeContainer.appendChild(img);

  setTimeout(() => {
    img.style.opacity = 0;
    setTimeout(() => img.remove(), 500);
  }, 800);
}

document.addEventListener("mousemove", e => {
  cursor.style.left = e.clientX + "px";
  cursor.style.top = e.clientY + "px";
  
  // ì§‘ ì´ë¯¸ì§€ ìƒì„±
  const now = Date.now();
  if(now - lastCreateTime > 50){
    createHomeImage(e.clientX, e.clientY);
    lastCreateTime = now;
  }
});

// ê²Œì„ ìƒíƒœ
let hasMovedFirstBlock = false;   // í•œ ë¸”ëŸ­ ì´ë™ ì™„ë£Œ ì—¬ë¶€
let hasTurnedLeft = false;        // ì™¼ìª½ìœ¼ë¡œ êº¾ìŒ ì—¬ë¶€
let hasDoneSigns = false;         // í‘œì§€íŒ ìº¡ì±  ì™„ë£Œ ì—¬ë¶€
let hasDoneTrains = false;        // ê¸°ì°¨ ìº¡ì±  ì™„ë£Œ ì—¬ë¶€

// ìº¡ì±  ì—´ë ¤ìˆëŠ”ì§€ ì—¬ë¶€
function isCaptchaOpen(){
  return captchaModal.classList.contains("show");
}

function openCaptcha(){
  captchaModal.classList.add("show");
  captchaError.textContent = "";
}

function closeCaptcha(){
  captchaModal.classList.remove("show");
  captchaImgContainer.innerHTML = "";
  captchaOptions.innerHTML = "";
  captchaError.textContent = "";
  captchaImgContainer.classList.remove("single","multiple");
}

// ê³µí†µ ë²„íŠ¼ ì„¸íŒ…
function createButton(text, type="primary"){
  const btn = document.createElement("button");
  btn.textContent = text;
  btn.classList.add("captcha-btn");
  if(type === "primary") btn.classList.add("primary");
  else btn.classList.add("secondary");
  return btn;
}

// ----- 1ë‹¨ê³„: ìë™ì°¨ ì˜ˆ/ì•„ë‹ˆì˜¤ ìº¡ì±  -----
let carPhase = 0; // 0: ìë™ì°¨ ì—†ëŠ” ì‚¬ì§„, 1: ìë™ì°¨ ìˆëŠ” ì‚¬ì§„

function startCarCaptcha(){
  // ì§€ì§€ì§ íš¨ê³¼ ì‹œì‘
  if(glitchOverlay){
    glitchOverlay.classList.add("show");
  }
  
  // ì§€ì§€ì§ íš¨ê³¼ í›„ ìº¡ì±  í‘œì‹œ
  setTimeout(() => {
    if(glitchOverlay){
      glitchOverlay.classList.remove("show");
    }
    openCaptcha();
    carPhase = 0;
    captchaTitle.textContent = "í•œ ë¸”ëŸ­ ì´ë™";
    captchaText.innerHTML = "í•œ ë¸”ëŸ­ ì´ë™ ì‹œ <b>ìë™ì°¨ê°€ ë³´ì—¬ì•¼</b> í•©ë‹ˆë‹¤.<br>ì•„ë˜ ì‚¬ì§„ì€ ìë™ì°¨ê°€ í¬í•¨ëœ ì‚¬ì§„ì¸ê°€ìš”?";
    captchaImgContainer.innerHTML = "";
    captchaImgContainer.classList.add("single");

    const img = document.createElement("img");
    // ìë™ì°¨ ì—†ëŠ” ì‚¬ì§„ (ë„¤ê°€ ê°€ì§„ ì´ë¯¸ì§€ë¡œ ë³€ê²½í•´)
    img.src = "carnone.png";
    img.alt = "ìë™ì°¨ê°€ ì—†ëŠ” ì‚¬ì§„";
    captchaImgContainer.appendChild(img);

    captchaOptions.innerHTML = "";
    const yesBtn = createButton("ì˜ˆ","primary");
    const noBtn = createButton("ì•„ë‹ˆì˜¤","secondary");
    captchaOptions.appendChild(yesBtn);
    captchaOptions.appendChild(noBtn);

    yesBtn.onclick = () => {
      if(carPhase === 1){
        // ì •ë‹µ
        closeCaptcha();
        hasMovedFirstBlock = true;
        showStatusMessage("ì™¼ìª½ìœ¼ë¡œ êº¾ëŠ”ì¤‘", 2000);
        hint.textContent = "í™”ë©´ì„ ë‹¤ì‹œ í´ë¦­í•˜ì„¸ìš”";
      }else{
        captchaError.textContent = "ë‹¤ì‹œ ìƒê°í•´ ë³´ì„¸ìš”.";
      }
    };

    noBtn.onclick = () => {
      if(carPhase === 0){
        // ë‘ ë²ˆì§¸ ì‚¬ì§„(ìë™ì°¨ ìˆëŠ” ì‚¬ì§„)ìœ¼ë¡œ ë³€ê²½
        carPhase = 1;
        img.src = "caryes.png"; // ìë™ì°¨ ìˆëŠ” ì‚¬ì§„ìœ¼ë¡œ ë°”ê¿”ì¤˜
        img.alt = "ìë™ì°¨ê°€ ìˆëŠ” ì‚¬ì§„";
        captchaText.innerHTML = "ì´ë²ˆ ì‚¬ì§„ì€ ìë™ì°¨ê°€ í¬í•¨ëœ ì‚¬ì§„ì¸ê°€ìš”?";
        captchaError.textContent = "";
      }else{
        captchaError.textContent = "ë‹¤ì‹œ ìƒê°í•´ ë³´ì„¸ìš”.";
      }
    };
  }, 800); // 0.8ì´ˆ ì§€ì§€ì§ íš¨ê³¼ í›„ ìº¡ì±  í‘œì‹œ
}

// ----- 2ë‹¨ê³„: í‘œì§€íŒ ì—¬ëŸ¬ ì¥ ì„ íƒ -----
function startSignCaptcha(){
  // ë°°ê²½ ì´ë¯¸ì§€ë¥¼ road2.pngë¡œ ë³€ê²½
  const backgroundOverlay = document.getElementById("background-overlay");
  if(backgroundOverlay){
    backgroundOverlay.classList.add("show");
  }
  
  openCaptcha();
  captchaTitle.textContent = "ì™¼ìª½ìœ¼ë¡œ êº¾ê¸°";
  captchaText.innerHTML = "ì™¼ìª½ìœ¼ë¡œ êº¾ì—ˆì„ ë•Œ <b>í‘œì§€íŒì´ ë³´ì—¬ì•¼</b> í•©ë‹ˆë‹¤.<br>í‘œì§€íŒì´ í¬í•¨ëœ ì‚¬ì§„ì„ ëª¨ë‘ ê³ ë¥´ì‹œì˜¤.";
  captchaImgContainer.innerHTML = "";
  captchaImgContainer.classList.add("multiple");

  const imgs = [
    {src:"sign1.png", alt:"í‘œì§€íŒ ìˆëŠ” ì‚¬ì§„ 1", correct:true},
    {src:"sign2.png", alt:"í‘œì§€íŒ ì—†ëŠ” ì‚¬ì§„ 2", correct:false},
    {src:"sign3.png", alt:"í‘œì§€íŒ ìˆëŠ” ì‚¬ì§„ 3", correct:true},
    {src:"sign4.png", alt:"í‘œì§€íŒ ì—†ëŠ” ì‚¬ì§„ 4", correct:false},
    {src:"sign5.png", alt:"í‘œì§€íŒ ì—†ëŠ” ì‚¬ì§„ 5", correct:false},
    {src:"sign6.png", alt:"í‘œì§€íŒ ìˆëŠ” ì‚¬ì§„ 6", correct:true}
  ];

  const selected = new Set();

  imgs.forEach((info, index) => {
    const wrap = document.createElement("div");
    wrap.classList.add("captcha-thumb");
    wrap.dataset.correct = info.correct ? "true" : "false";
    wrap.dataset.index = index.toString();

    const img = document.createElement("img");
    img.src = info.src; // ì‹¤ì œ í‘œì§€íŒ/ë°°ê²½ ì´ë¯¸ì§€ë¡œ êµì²´
    img.alt = info.alt;

    wrap.appendChild(img);
    captchaImgContainer.appendChild(wrap);

    wrap.addEventListener("click", () => {
      if(selected.has(index)){
        selected.delete(index);
        wrap.classList.remove("selected");
      }else{
        selected.add(index);
        wrap.classList.add("selected");
      }
      captchaError.textContent = "";
    });
  });

  captchaOptions.innerHTML = "";
  const confirmBtn = createButton("ì„ íƒ ì™„ë£Œ","primary");
  const cancelBtn = createButton("ë‹¤ì‹œ ì„ íƒ","secondary");
  captchaOptions.appendChild(confirmBtn);
  captchaOptions.appendChild(cancelBtn);

  confirmBtn.onclick = () => {
    // ì •ë‹µ: correct=trueì¸ ê²ƒë§Œ ëª¨ë‘ ì„ íƒ, ë‚˜ë¨¸ì§€ëŠ” ì„ íƒ X
    let ok = true;
    imgs.forEach((info, index) => {
      const shouldBe = !!info.correct;
      const isSelected = selected.has(index);
      if(shouldBe !== isSelected) ok = false;
    });

    if(ok){
      closeCaptcha();
      hasTurnedLeft = true;
      hasDoneSigns = true;
      showStatusMessage("ë‘ ë¸”ëŸ­ ì´ë™ì¤‘..", 2000);
      hint.textContent = "í™”ë©´ì„ ë‹¤ì‹œ í´ë¦­í•˜ì„¸ìš”";
    }else{
      captchaError.textContent = "í‘œì§€íŒì´ ìˆëŠ” ì‚¬ì§„ë§Œ, ê·¸ë¦¬ê³  ëª¨ë‘ ê³¨ë¼ì•¼ í•©ë‹ˆë‹¤.";
    }
  };

  cancelBtn.onclick = () => {
    selected.clear();
    document.querySelectorAll(".captcha-thumb").forEach(el => el.classList.remove("selected"));
    captchaError.textContent = "";
  };
}

// ----- 3ë‹¨ê³„: ê¸°ì°¨ ì—¬ëŸ¬ ì¥ ì„ íƒ -----
function startTrainCaptcha(){
  // ë°°ê²½ ì´ë¯¸ì§€ë¥¼ road3.pngë¡œ ë³€ê²½
  const backgroundOverlay2 = document.getElementById("background-overlay-2");
  if(backgroundOverlay2){
    backgroundOverlay2.classList.add("show");
  }
  
  openCaptcha();
  captchaTitle.textContent = "ë§ˆì§€ë§‰ìœ¼ë¡œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ êº¾ê¸°";
  captchaText.innerHTML = "ì˜¤ë¥¸ìª½ìœ¼ë¡œ êº¾ì—ˆì„ ë•Œ <b>ê¸°ì°¨ê°€ ë³´ì—¬ì•¼</b> í•©ë‹ˆë‹¤.<br>ê¸°ì°¨ê°€ í¬í•¨ëœ ì‚¬ì§„ì„ ëª¨ë‘ ê³ ë¥´ì‹œì˜¤.";
  captchaImgContainer.innerHTML = "";
  captchaImgContainer.classList.add("multiple");

  const imgs = [
    {src:"train1.png", alt:"ê¸°ì°¨ ìˆëŠ” ì‚¬ì§„ 1", correct:true},
    {src:"train2.png", alt:"ê¸°ì°¨ ì—†ëŠ” ì‚¬ì§„ 2", correct:false},
    {src:"train3.png", alt:"ê¸°ì°¨ ìˆëŠ” ì‚¬ì§„ 3", correct:true},
    {src:"train4.png", alt:"ê¸°ì°¨ ì—†ëŠ” ì‚¬ì§„ 4", correct:false}
  ];

  const selected = new Set();

  imgs.forEach((info, index) => {
    const wrap = document.createElement("div");
    wrap.classList.add("captcha-thumb");
    wrap.dataset.correct = info.correct ? "true" : "false";
    wrap.dataset.index = index.toString();

    const img = document.createElement("img");
    img.src = info.src; // ì‹¤ì œ ê¸°ì°¨/ë°°ê²½ ì´ë¯¸ì§€ë¡œ êµì²´
    img.alt = info.alt;

    wrap.appendChild(img);
    captchaImgContainer.appendChild(wrap);

    wrap.addEventListener("click", () => {
      if(selected.has(index)){
        selected.delete(index);
        wrap.classList.remove("selected");
      }else{
        selected.add(index);
        wrap.classList.add("selected");
      }
      captchaError.textContent = "";
    });
  });

  captchaOptions.innerHTML = "";
  const confirmBtn = createButton("ì„ íƒ ì™„ë£Œ","primary");
  const cancelBtn = createButton("ë‹¤ì‹œ ì„ íƒ","secondary");
  captchaOptions.appendChild(confirmBtn);
  captchaOptions.appendChild(cancelBtn);

  confirmBtn.onclick = () => {
    let ok = true;
    imgs.forEach((info, index) => {
      const shouldBe = !!info.correct;
      const isSelected = selected.has(index);
      if(shouldBe !== isSelected) ok = false;
    });

    if(ok){
      closeCaptcha();
      hasDoneTrains = true;
      finalMessageIndex = 0;
      showFinalMessages();
    }else{
      captchaError.textContent = "ê¸°ì°¨ê°€ ìˆëŠ” ì‚¬ì§„ë§Œ, ê·¸ë¦¬ê³  ëª¨ë‘ ê³¨ë¼ì•¼ í•©ë‹ˆë‹¤.";
    }
  };

  cancelBtn.onclick = () => {
    selected.clear();
    document.querySelectorAll(".captcha-thumb").forEach(el => el.classList.remove("selected"));
    captchaError.textContent = "";
  };
}

// ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
function showStatusMessage(text, duration = 2000){
  statusMessage.textContent = text;
  statusMessage.classList.add("show");
  setTimeout(() => {
    statusMessage.classList.remove("show");
  }, duration);
}

// ìµœì¢… ë©”ì‹œì§€ (doorone ìŠ¤íƒ€ì¼)
const finalMessages = [
  "ë“œë””ì–´ ë„ì°©í–ˆë„¤.",
  "ê·¸ëŸ°ë°..."
];

let finalMessageIndex = -1;
let isTypingFinal = false;
let finalTypingTimeout = null;

function showFinalMessages(){
  // í…ìŠ¤íŠ¸ ë°•ìŠ¤ í‘œì‹œ
  speakerLabel.classList.add("show");
  subtitleBox.classList.add("show");
  finalMessageIndex = 0;
  
  // ì²« ë©”ì‹œì§€ íƒ€ì´í•‘
  isTypingFinal = true;
  typeText(finalMessages[0], () => {
    isTypingFinal = false;
  });
}

// ê²Œì„ ì»¨í…Œì´ë„ˆ í´ë¦­ ì´ë²¤íŠ¸
gameContainer.addEventListener("click", (e) => {
  // ìº¡ì±  ëª¨ë‹¬ ë‚´ë¶€ í´ë¦­ì€ ë¬´ì‹œ
  if(e.target.closest("#captcha-modal")) return;
  
  // ìº¡ì±  ë–  ìˆì„ ë• ë¬´ì‹œ
  if(isCaptchaOpen()) return;

  // ì•„ì§ í•œ ë¸”ëŸ­ ì´ë™ ì „ â†’ ì²« í´ë¦­ ì‹œ ìë™ì°¨ ìº¡ì± 
  if(!hasMovedFirstBlock){
    startCarCaptcha();
    return;
  }

  // ìë™ì°¨ ìº¡ì±  ëë‚¬ê³ , ì•„ì§ ì™¼ìª½ìœ¼ë¡œ ì•ˆ êº¾ì—ˆìœ¼ë©´ í´ë¦­ ì‹œ í‘œì§€íŒ ìº¡ì± 
  if(hasMovedFirstBlock && !hasDoneSigns){
    startSignCaptcha();
    return;
  }

  // í‘œì§€íŒ ìº¡ì±  ëë‚¬ê³ , í´ë¦­ ì‹œ ê¸°ì°¨ ìº¡ì± 
  if(hasDoneSigns && !hasDoneTrains){
    startTrainCaptcha();
    return;
  }
});

// ìµœì¢… ">" í´ë¦­ ì‹œ ë¬¸êµ¬ ë³´ì—¬ì£¼ê³  doors.htmlë¡œ ì´ë™
if(stationNextBtn){
  stationNextBtn.addEventListener("click", () => {
    stationText2.style.display = "block";
    setTimeout(() => {
      location.href = "doors.html";
    }, 3000);
  });
}
</script>

</body>
</html>
