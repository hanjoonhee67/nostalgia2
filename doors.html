<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>문 선택</title>
<link href="https://fonts.googleapis.com/css2?family=Orbit:wght@400&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{
  width:100%;height:100%;overflow:hidden;
  font-family:"Orbit";
  cursor:none;
}

/* 3D 공간 */
#space{
  width:100vw;height:100vh;
  perspective:1200px;
  perspective-origin:50% 45%;
  background:#0000aa;
  position:relative;
  overflow:hidden;
}

/* 노이즈 오버레이 */
#noise{
  position:fixed;
  inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  opacity:0.08;
  pointer-events:none;
  z-index:100;
  mix-blend-mode:overlay;
}

/* 스캔라인 */
#scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 2px,
    rgba(0,0,0,0.15) 2px,
    rgba(0,0,0,0.15) 4px
  );
  pointer-events:none;
  z-index:101;
}

/* 체커보드 바닥 */
#floor{
  position:absolute;
  width:400vw; height:400vh;
  left:-150vw; top:58%;
  transform:rotateX(88deg);
  background-image:
    repeating-conic-gradient(#0a0a0a 0% 25%, #f0f0f0 0% 50%);
  background-size:100px 100px;
  transform-origin:center top;
  transition:background-position 0.1s;
}

/* 문 컨테이너 - 3D 회전 */
#doors-container{
  position:absolute;
  left:50%;top:50%;
  transform-style:preserve-3d;
  transition:transform 0.15s ease-out;
}

/* 문 */
.door{
  position:absolute;
  width:200px;
  height:320px;
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center bottom;
  cursor:pointer;
  transition:transform 0.3s, filter 0.3s, opacity 0.3s;
  transform-style:preserve-3d;
}

.door:hover{
  filter:drop-shadow(0 0 40px rgba(255,255,255,0.4)) !important;
}

.door-label{
  position:absolute;
  bottom:-40px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:0.95rem;
  white-space:nowrap;
  text-shadow:0 2px 10px rgba(0,0,0,0.9);
}

/* 커서 */
#cursor-dot{
  position:fixed;
  width:14px;height:14px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,0.9);
  transform:translate(-50%,-50%);
  pointer-events:none;
  z-index:9999;
}

/* 안내문 */
#hint{
  position:fixed;
  top:25px;left:50%;
  transform:translateX(-50%);
  color:white;
  opacity:0.9;font-size:0.95rem;
  z-index:5;
  text-shadow:0 2px 6px rgba(0,0,0,0.6);
}

/* 윈도우 에러 텍스트 */
.error-text{
  position:fixed;
  color:white;
  font-family:"Courier New", monospace;
  font-size:14px;
  opacity:0.3;
  pointer-events:none;
  z-index:1;
}

/* 좌우 화살표 힌트 */
.arrow-hint{
  position:fixed;
  top:50%;
  transform:translateY(-50%);
  font-size:2rem;
  color:rgba(255,255,255,0.4);
  z-index:10;
  pointer-events:none;
  animation:pulse 1.5s infinite;
}
.arrow-hint.left{left:30px;}
.arrow-hint.right{right:30px;}

@keyframes pulse{
  0%,100%{opacity:0.4;}
  50%{opacity:0.8;}
}
</style>
</head>
<body>

<div id="space">
  <div id="floor"></div>
  <div id="doors-container"></div>
</div>

<div id="noise"></div>
<div id="scanlines"></div>

<div class="arrow-hint left">◀</div>
<div class="arrow-hint right">▶</div>

<div id="hint">좌우로 드래그하거나 스크롤해서 문을 둘러보세요</div>
<div id="cursor-dot"></div>

<script>
const container = document.getElementById("doors-container");
const space = document.getElementById("space");
const floor = document.getElementById("floor");

// 에러 텍스트 추가
const errorTexts = [
  "A fatal exception 0E has occurred",
  "Press any key to continue _",
  "KERNEL32.DLL",
  "0x0000007E"
];

errorTexts.forEach((text, i) => {
  const el = document.createElement("div");
  el.className = "error-text";
  el.textContent = text;
  el.style.left = (8 + Math.random() * 15) + "%";
  el.style.top = (20 + i * 12) + "%";
  document.body.appendChild(el);
});

// 문 데이터
const doorPresets = [
  { img:"door1.png", label:"첫 번째 문", link:"house1.html" },
  { img:"door2.png", label:"두 번째 문", link:"house2.html" },
  { img:"door3.png", label:"세 번째 문", link:"house3.html" },
  { img:"door4.png", label:"네 번째 문", link:"house4.html" },
  { img:"door5.png", label:"마지막 문", link:"ending.html" }
];

const doors = [];
const radius = 500; // 원형 배치 반지름
const totalDoors = doorPresets.length;
let firstClick = true; // 첫 클릭 여부

doorPresets.forEach((data, i) => {
  const door = document.createElement("div");
  door.className = "door";
  door.style.backgroundImage = `url(${data.img})`;
  door.dataset.index = i;
  door.dataset.link = data.link;
  
  const label = document.createElement("div");
  label.className = "door-label";
  label.textContent = data.label;
  door.appendChild(label);
  
  door.addEventListener("click", () => {
    if(firstClick){
      firstClick = false;
      location.href = "doorone.html";
    } else {
      if(data.link) location.href = data.link;
    }
  });
  
  container.appendChild(door);
  doors.push(door);
});

// 회전 각도
let currentAngle = 0;
let targetAngle = 0;
const anglePerDoor = 360 / totalDoors;

// 문 위치 업데이트
function updateDoors(){
  doors.forEach((door, i) => {
    const angle = (i * anglePerDoor + currentAngle) * Math.PI / 180;
    
    const x = Math.sin(angle) * radius;
    const z = Math.cos(angle) * radius - radius;
    
    // 앞에 있을수록 크고 선명하게
    const scale = 0.6 + (Math.cos(angle) + 1) * 0.35;
    const opacity = 0.3 + (Math.cos(angle) + 1) * 0.35;
    const blur = Math.max(0, (1 - Math.cos(angle)) * 2);
    
    door.style.transform = `
      translate(-50%, -50%)
      translateX(${x}px)
      translateZ(${z}px)
      rotateY(${-currentAngle - i * anglePerDoor}deg)
      scale(${scale})
    `;
    door.style.opacity = opacity;
    door.style.filter = `drop-shadow(0 20px 40px rgba(0,0,0,0.6)) blur(${blur}px)`;
    door.style.zIndex = Math.floor(1000 + z);
  });
  
  // 바닥도 살짝 움직이기
  floor.style.backgroundPosition = `${currentAngle * 2}px 0`;
}

// 부드러운 회전 애니메이션
function animate(){
  currentAngle += (targetAngle - currentAngle) * 0.08;
  updateDoors();
  requestAnimationFrame(animate);
}
animate();

// 휠로 회전
window.addEventListener("wheel", e => {
  targetAngle += e.deltaY * 0.15;
  e.preventDefault();
}, {passive:false});

// 드래그로 회전
let isDragging = false;
let startX = 0;
let startAngle = 0;

document.addEventListener("mousedown", e => {
  isDragging = true;
  startX = e.clientX;
  startAngle = targetAngle;
});

document.addEventListener("mousemove", e => {
  if(isDragging){
    const diff = e.clientX - startX;
    targetAngle = startAngle + diff * 0.3;
  }
});

document.addEventListener("mouseup", () => {
  isDragging = false;
});

// 터치 지원
document.addEventListener("touchstart", e => {
  isDragging = true;
  startX = e.touches[0].clientX;
  startAngle = targetAngle;
});

document.addEventListener("touchmove", e => {
  if(isDragging){
    const diff = e.touches[0].clientX - startX;
    targetAngle = startAngle + diff * 0.3;
  }
});

document.addEventListener("touchend", () => {
  isDragging = false;
});

/* 커서 */
const cursor = document.getElementById("cursor-dot");
document.addEventListener("mousemove", e => {
  cursor.style.left = e.clientX + "px";
  cursor.style.top = e.clientY + "px";
});

/* 마우스로 시점 살짝 움직이기 */
document.addEventListener("mousemove", e => {
  if(!isDragging){
    const x = (e.clientX / window.innerWidth - 0.5) * 6;
    const y = (e.clientY / window.innerHeight - 0.5) * 3;
    space.style.perspectiveOrigin = `${50 + x}% ${45 + y}%`;
  }
});

/* 노이즈 애니메이션 */
const noise = document.getElementById("noise");
setInterval(() => {
  noise.style.transform = `translate(${Math.random()*5}px, ${Math.random()*5}px)`;
}, 100);
</script>

</body>
</html>
