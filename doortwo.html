<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ë¯¼ë“¤ê³¼ ëŒ€í™”</title>
<link href="https://fonts.googleapis.com/css2?family=Orbit:wght@400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  width:100vw;height:100vh;
  overflow:hidden;
  font-family:"Orbit";
  cursor:none;
  position:relative;
  perspective:1000px;
}

/* ë°°ê²½ ì´ë¯¸ì§€ - í”ë“¤ë¦¼ íš¨ê³¼ */
#bg-image{
  position:fixed;
  inset:0;
  background:url('town.png') center/cover no-repeat;
  background-size:110% 110%;
  z-index:0;
  animation:cameraShake 4s ease-in-out infinite;
}

/* ê²€ì€ ì˜¤ë²„ë ˆì´ - ëˆˆì„ ëœ¨ëŠ” ê²ƒì²˜ëŸ¼ í˜ì´ë“œì•„ì›ƒ */
#black-overlay{
  position:fixed;
  inset:0;
  background:#000;
  z-index:1000;
  pointer-events:none;
  animation:fadeOutEyes 2s ease-out forwards;
}

@keyframes fadeOutEyes{
  0%{opacity:1;}
  100%{opacity:0;}
}

/* ìŒì•… í”Œë ˆì´ì–´ - ìœˆë„ìš° ì°½ ìŠ¤íƒ€ì¼ */
#music-player{
  position:fixed;
  top:120px;
  right:100px;
  z-index:200;
  background:#C0C0C0;
  border:3px outset #C0C0C0;
  padding:0;
  box-shadow:inset 1px 1px 0px #000, inset -1px -1px 0px #fff, 2px 2px 4px rgba(0,0,0,0.3);
  font-family:"MS Sans Serif", "Segoe UI", sans-serif;
  min-width:200px;
}

#music-player-title{
  background:#000080;
  color:#fff;
  font-size:0.75rem;
  margin:0;
  padding:3px 6px;
  text-align:left;
  font-weight:normal;
  border-bottom:2px solid #000;
}

#music-player-content{
  padding:8px;
  display:flex;
  align-items:center;
  gap:8px;
}

#music-toggle{
  background:#C0C0C0;
  border:2px outset #C0C0C0;
  color:#000;
  padding:3px 12px;
  cursor:pointer;
  font-size:0.7rem;
  font-family:"MS Sans Serif", "Segoe UI", sans-serif;
  min-width:50px;
}

#music-toggle:active{
  border:2px inset #C0C0C0;
}

#volume-control{
  display:flex;
  align-items:center;
  gap:5px;
  font-size:0.7rem;
  color:#000;
}

#volume-slider{
  width:70px;
  height:4px;
  background:#C0C0C0;
  border:1px inset #C0C0C0;
  outline:none;
  cursor:pointer;
}

#volume-slider::-webkit-slider-thumb{
  appearance:none;
  width:10px;
  height:10px;
  background:#C0C0C0;
  border:1px outset #C0C0C0;
  cursor:pointer;
}

#volume-slider::-moz-range-thumb{
  width:10px;
  height:10px;
  background:#C0C0C0;
  border:1px outset #C0C0C0;
  cursor:pointer;
}

/* ì±•í„° í‘œì‹œ */
#chapter-label{
  position:fixed;
  top:30px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:1.2rem;
  font-weight:bold;
  font-family:"Orbit", sans-serif;
  z-index:200;
  text-shadow:0 2px 10px rgba(0,0,0,0.5);
  letter-spacing:3px;
}

/* í”„ë ˆì„ ì´ë¯¸ì§€ */
#web-frame{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  object-fit:cover;
  z-index:9999;
  pointer-events:none;
}

/* ìœˆë„ìš° ë…¸ì´ì¦ˆ íš¨ê³¼ */
#window-noise{
  position:fixed;
  inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  opacity:0.15;
  pointer-events:none;
  z-index:10000;
  mix-blend-mode:overlay;
  animation:noiseFlicker 0.1s infinite;
}

@keyframes noiseFlicker{
  0%,100%{opacity:0.1;}
  50%{opacity:0.2;}
}

/* ìŠ¤ìº”ë¼ì¸ íš¨ê³¼ */
#scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 2px,
    rgba(0,0,0,0.1) 2px,
    rgba(0,0,0,0.1) 4px
  );
  pointer-events:none;
  z-index:10001;
}

/* íŒŒë€ Error í™”ë©´ ì˜¤ë²„ë ˆì´ */
#error-overlay{
  position:fixed;
  inset:0;
  background:#0000aa;
  opacity:0.4;
  z-index:1;
  pointer-events:none;
  transition:opacity 0.5s;
}

/* ìŠ¤í”¼ì»¤ ë¼ë²¨ */
#speaker-label{
  position:fixed;
  bottom:210px;
  left:50%;
  transform:translateX(-50%);
  margin-left:-280px;
  background:rgba(0,0,100,0.85);
  color:white;
  padding:8px 16px;
  border-radius:8px;
  font-size:0.9rem;
  font-weight:bold;
  text-transform:uppercase;
  z-index:100;
  pointer-events:none;
  font-family:"Orbit", sans-serif;
  opacity:0;
  transition:opacity 0.3s;
}

#speaker-label.show{opacity:1;}

/* ìë§‰ë°” */
#subtitle-box{
  position:fixed;
  bottom:90px;
  left:50%;
  transform:translateX(-50%);
  width:600px;
  max-width:90%;
  background:rgba(0,0,0,0.6);
  padding:20px 30px;
  z-index:100;
  cursor:pointer;
  transition:background 0.3s;
  min-height:80px;
  display:flex;
  align-items:center;
  border-radius:10px;
  backdrop-filter:blur(5px);
  opacity:0;
  pointer-events:none;
}

#subtitle-box.show{
  opacity:1;
  pointer-events:auto;
}

#subtitle-box:hover{
  background:rgba(0,0,0,0.75);
}

#subtitle-text{
  color:white;
  font-size:1.1rem;
  line-height:1.6;
  font-family:"Orbit", sans-serif;
  width:100%;
  max-width:90%;
}

/* íƒ€ì´í•‘ ì»¤ì„œ */
#typing-cursor{
  display:inline-block;
  width:2px;
  height:1.2em;
  background:white;
  margin-left:4px;
  animation:blinkCursor 1s infinite;
  vertical-align:middle;
}

@keyframes blinkCursor{
  0%,50%{opacity:1;}
  51%,100%{opacity:0;}
}

/* ëŒ€í™” í™”ë©´ */
#dialogue-scene{
  position:fixed;
  inset:0;
  z-index:100;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.5s;
}

#dialogue-scene.show{
  opacity:1;
  pointer-events:auto;
}

/* ëŒ€í™” í™”ë©´ ë°°ê²½ */
#dialogue-bg{
  position:fixed;
  inset:0;
  background:url('talk.png') center/cover no-repeat;
  z-index:99;
}

/* ëŒ€í™” ì¸ë¬¼ - ëŒ€í™”ì°½ ìœ—ë¶€ë¶„ì— ë”± ë¶™ê²Œ */
#dialogue-person{
  position:fixed;
  bottom:300px;
  right:0%;
  width:1000px;
  height:auto;
  max-height:95vh;
  z-index:100;
  object-fit:contain;
  object-position:center bottom;
  transform:translateX(20%);
}

/* ìŠ¤í”¼ì»¤ ì´ë¦„ */
#dialogue-speaker{
  position:fixed;
  bottom:140px;
  left:5%;
  background:rgba(70,130,200,0.9);
  color:white;
  padding:10px 20px;
  border-radius:8px;
  font-size:1rem;
  font-weight:bold;
  z-index:102;
  font-family:"Orbit", sans-serif;
}

/* ëŒ€í™” í…ìŠ¤íŠ¸ ë°•ìŠ¤ */
#dialogue-subtitle{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:300px;
  background:linear-gradient(180deg, rgb(255, 255, 255) 0%, #9e9cff 50%, #4a47ff 100%);
  z-index:102;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  padding:20px 40px;
  padding-left:5%;
}

#dialogue-text{
  color:#000;
  font-size:1.2rem;
  line-height:1.6;
  text-align:left;
  max-width:60%;
  font-family:"Orbit", sans-serif;
}

/* ì£¼ë¯¼ ëª©ë¡ */
#residents-container{
  position:fixed;
  inset:0;
  z-index:1;
  pointer-events:none;
  opacity:0.5;
  transition:opacity 0.5s, pointer-events 0.5s;
}

#residents-container.active{
  pointer-events:auto;
  opacity:1;
}

.resident{
  position:absolute;
  width:250px;
  height:auto;
  cursor:pointer;
  transition:filter 0.3s;
  pointer-events:auto;
  z-index:2;
  filter:blur(2px);
}

.resident:hover{
  filter:blur(1px) brightness(1.1);
}

.speech-bubble{
  position:absolute;
  bottom:220px;
  left:50%;
  transform:translateX(-50%);
  background:white;
  padding:15px 20px;
  border-radius:15px;
  max-width:250px;
  font-size:0.9rem;
  color:#333;
  opacity:0;
  pointer-events:none;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
  transition:opacity 0.3s;
}

.speech-bubble::after{
  content:"";
  position:absolute;
  bottom:-10px;
  left:50%;
  transform:translateX(-50%);
  border:10px solid transparent;
  border-top-color:white;
}

.speech-bubble.show{
  opacity:1;
  pointer-events:auto;
}

/* í•˜ë‹¨ íŒíŠ¸ */
#hint{
  position:fixed;
  bottom:30px;left:50%;
  transform:translateX(-50%);
  color:#666;
  font-size:0.85rem;
  z-index:10;
  opacity:0.7;
}

/* ë§ˆìš°ìŠ¤ ì  */
#cursor-dot{
  position:fixed;
  width:14px;height:14px;
  border-radius:50%;
  border:2px solid rgba(0,0,0,0.6);
  transform:translate(-50%,-50%);
  pointer-events:none;
  z-index:9999;
}

/* ì»¤ì„œ ì§‘ ì•„ì´ì½˜ */
#home-container{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:1000;
}

.home{
  position:absolute;
  width:100px;
  pointer-events:none;
  mix-blend-mode:screen;
  opacity:0.8;
  transition:transform 0.1s ease-out, opacity 0.5s ease-out;
  will-change:transform;
  z-index:1000;
}

/* ìƒë‹¨ íŒíŠ¸ */
#top-hint{
  position:fixed;
  top:30px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:1rem;
  z-index:50;
  opacity:0;
  pointer-events:none;
  background:rgba(0,0,0,0.6);
  padding:10px 20px;
  border-radius:20px;
  backdrop-filter:blur(5px);
  transition:opacity 0.5s;
}

#top-hint.show{
  opacity:1;
  pointer-events:auto;
}

/* ì¤‘ì•™ ì•ˆë‚´ ë¬¸êµ¬ */
#center-hint{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  color:white;
  font-size:1.1rem;
  z-index:10;
  background:rgba(0,0,0,0.75);
  padding:15px 30px;
  border-radius:20px;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.5s;
  text-align:center;
}
#center-hint.show{
  opacity:1;
  pointer-events:auto;
}

/* ì¹´ë©”ë¼ í”ë“¤ë¦¼ */
@keyframes cameraShake{
  0%{transform:translateX(0px);}
  25%{transform:translateX(-2px);}
  50%{transform:translateX(0px);}
  75%{transform:translateX(2px);}
  100%{transform:translateX(0px);}
}

/* ì£¼ë¯¼ ì´ë¯¸ì§€ í”ë“¤ë¦¼ */
.resident img{
  width:100%;
  height:auto;
  display:block;
  filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3));
  animation:cameraShake 4s ease-in-out infinite;
}

/* ë¹„ë„¤íŠ¸ íš¨ê³¼ */
#vignette{
  position:fixed;
  inset:0;
  background:radial-gradient(ellipse at center, transparent 0%, transparent 60%, rgba(0,0,0,0.4) 100%);
  pointer-events:none;
  z-index:200;
}
</style>
</head>
<body>

<img id="web-frame" src="web frame.png" alt="frame">
<div id="window-noise"></div>
<div id="scanlines"></div>
<div id="chapter-label">CHAPTER 2</div>
<div id="music-player">
  <div id="music-player-title">ìŒì•… í”Œë ˆì´ì–´</div>
  <div id="music-player-content">
    <button id="music-toggle">ì¬ìƒ</button>
    <div id="volume-control">
      <span>ğŸ”Š</span>
      <input type="range" id="volume-slider" min="0" max="100" value="50">
    </div>
  </div>
</div>
<audio id="bgmusic" loop>
  <source src="bgmusic.mp3" type="audio/mpeg">
</audio>
<div id="bg-image"></div>
<div id="black-overlay"></div>
<div id="error-overlay"></div>
<div id="vignette"></div>

<div id="speaker-label">YOU</div>
<div id="subtitle-box">
  <div id="subtitle-text"></div>
</div>

<div id="residents-container">
  <div class="resident" data-dialogue="ì–´ë””ì„œ ì˜¤ì…¨ì–´ìš”?" style="left:23%; top:30%; width:220px;">
    <img src="people1.png" alt="ì£¼ë¯¼">
  </div>
  
  <div class="resident" data-dialogue="ê¸ˆë°© ì ì‘í•˜ì‹¤ ê±°ì˜ˆìš”." style="right:13%; top:40%; width:350px;">
    <img src="people2.png" alt="ì£¼ë¯¼">
  </div>
  
  <div class="resident" data-dialogue="ì—¬ê¸´ ì¡°ìš©í•´ì„œ ì¢‹ì•„ìš”. ê·¸ë ‡ì£ ?" style="right:15%; top:20%; width:150px;">
    <img src="people3.png" alt="ì£¼ë¯¼">
  </div>
</div>

<div id="home-container"></div>
<div id="top-hint">ì£¼ë¯¼ë“¤ì„ í´ë¦­í•´ë³´ì„¸ìš”</div>
<div id="hint">ì£¼ë¯¼ë“¤ì„ í´ë¦­í•´ë³´ì„¸ìš”</div>
<div id="center-hint">ì£¼ë¯¼ì„ í´ë¦­í•˜ì—¬ ëŒ€í™”í•´ë³´ì„¸ìš”.</div>
<div id="cursor-dot"></div>

<!-- ëŒ€í™” í™”ë©´ -->
<div id="dialogue-scene">
  <div id="dialogue-bg"></div>
  <img id="dialogue-person" src="" alt="ì£¼ë¯¼">
  <div id="dialogue-speaker">ì£¼ë¯¼ 1</div>
  <div id="dialogue-subtitle">
    <div id="dialogue-text"></div>
  </div>
</div>

<script>
const residents = document.querySelectorAll(".resident");
const cursor = document.getElementById("cursor-dot");
const dialogueScene = document.getElementById("dialogue-scene");
const dialogueText = document.getElementById("dialogue-text");
const dialoguePerson = document.getElementById("dialogue-person");
const bgmusic = document.getElementById("bgmusic");
const musicToggle = document.getElementById("music-toggle");
const volumeSlider = document.getElementById("volume-slider");

// ìŒì•… í”Œë ˆì´ì–´ ì œì–´
musicToggle.addEventListener("click", () => {
  if(bgmusic.paused){
    bgmusic.play();
    musicToggle.textContent = "ì •ì§€";
  }else{
    bgmusic.pause();
    musicToggle.textContent = "ì¬ìƒ";
  }
});

volumeSlider.addEventListener("input", (e) => {
  bgmusic.volume = e.target.value / 100;
});
const dialogueSpeaker = document.getElementById("dialogue-speaker");
const residentsContainer = document.getElementById("residents-container");
const hint = document.getElementById("hint");
const centerHint = document.getElementById("center-hint");
const subtitleBox = document.getElementById("subtitle-box");
const subtitleText = document.getElementById("subtitle-text");
const speakerLabel = document.getElementById("speaker-label");
const topHint = document.getElementById("top-hint");
const homeContainer = document.getElementById("home-container");
const errorOverlay = document.getElementById("error-overlay");

// ì£¼ë¯¼ë³„ ëŒ€í™” ë‚´ìš©
const dialogues = {
  0: [
    "ì–´ë””ì„œ ì˜¤ì…¨ì–´ìš”?",
    "ì˜†ì§‘ ì‚¬ëŠ” ì‚¬ëŒì¸ë°~ ì•ìœ¼ë¡œ ì˜ ì§€ë‚´ë´ìš”.",
    "ì´ì‚¬ ì¤€ë¹„í•˜ëŠë¼ ê³ ìƒí•˜ì…¨ì„í…ë°, ì´ê²ƒ ì¢€ ë¨¹ìœ¼ë©´ì„œ ì‰¬ì„¸ìš”~.",
    "(ì„ ë¬¼ê¹Œì§€ ë°›ì•„ë²„ë ¸ë‹¤...)"
  ],
  1: [
    "ëª» ë³´ë˜ ì–¼êµ´ì¸ë° ì´ì‚¬ì˜¤ì…¨ë‚˜ë´ìš”?",
    "ì ì‘í•˜ëŠë¼ í˜ë“¤ì£ ? ê¸ˆë°© ìµìˆ™í•´ì§€ì‹¤ ê±°ì˜ˆìš”~.",
    "ë„ì„œê´€ì´ë‚˜ ì´ê³³ì €ê³³ ê¶ê¸ˆí•˜ì‹  ê³³ ìˆìœ¼ë©´ ì•Œë ¤ë“œë¦´í…Œë‹ˆê¹Œ ë¶€ë‹´ê°–ì§€ë§ê³  ë¬¼ì–´ë³´ì…”ë„ ë¼ìš”."
  ],
  2: [
    "ê¸°ì°¨ì—­ì´ ì–´ë”˜ì§€ ì°¾ê³  ê³„ì‹œêµ°ìš”.",
    "ì—¬ê¸°ì„œ í•œ ë¸”ëŸ­ ê°„ í›„ì— ì™¼ ìª½ìœ¼ë¡œ êº¾ê³  ê·¸ëŸ¬ê³  ë‘ ë¸”ëŸ­ ë” ê°€ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ëŒì•„ê°€ì‹œë©´ ê¸°ì°¨ì—­ì´ ë‚˜ì˜¬ê±°ì˜ˆìš”!",
    "ì˜¤ë¥¸ ìª½ìœ¼ë¡œ êº¾ì–´ì„œ íŒŒë€ê°„íŒì´ ë‚˜ì˜¤ëŠ” ë°©í–¥ì´ ê¸°ì°¨ì—­ì´ë‹ˆê¹Œ ì˜ ê¸°ì–µí•´ë‘ê³  ì°¾ì•„ê°€ì‹œë©´ ë  ê²ƒ ê°™ì•„ìš”!"
  ]
};

// ì£¼ë¯¼ë³„ ì´ë¦„
const speakerNames = {
  0: "ì£¼ë¯¼ 1",
  1: "ì£¼ë¯¼ 2",
  2: "ì£¼ë¯¼ 3"
};

// ì´ˆê¸° ë©”ì‹œì§€
const introMessages = [
  "ì•„íŒŒíŠ¸ ë‹¨ì§€ë¥¼ ë²—ì–´ë‚˜, ë“œë””ì–´ ê±°ë¦¬ë¡œ ë“¤ì–´ì„°ë‹¤.",
  "ìƒˆë¡œìš´ ì´ì›ƒë“¤ì¸ê°€? ë§ì„ ê±¸ì–´ì˜¤ë ¤ëŠ” ê²ƒ ê°™ì€ë°..?"
];

let dialogueIndex = 0;
let isInDialogue = false;
let introMessageIndex = 0;
let isTyping = false;
let typingTimeout = null;
let canClickResidents = false;
let currentDialogueIndex = 0;
let currentResidentIndex = -1;
let isDialogueTyping = false;
let dialogueTypingTimeout = null;

// ì§‘ ì•„ì´ì½˜ ë”°ë¼ì˜¤ê¸°
const homeImgs = ['home2.png', 'home.png'];
let lastCreateTime = 0;

function createHomeImage(x, y){
  const img = document.createElement('img');
  img.src = homeImgs[Math.floor(Math.random() * homeImgs.length)];
  img.className = 'home';
  img.style.left = x + 'px';
  img.style.top = y + 'px';

  if(Math.random() > 0.5){
    img.style.width = '80px';
    img.style.opacity = '0.6';
    img.style.filter = 'blur(1.5px)';
  }

  homeContainer.appendChild(img);

  setTimeout(() => {
    img.style.opacity = 0;
    setTimeout(() => img.remove(), 500);
  }, 800);
}

document.addEventListener("mousemove", e => {
  cursor.style.left = e.clientX + "px";
  cursor.style.top = e.clientY + "px";
  
  // ì§‘ ì´ë¯¸ì§€ ìƒì„±
  const now = Date.now();
  if(now - lastCreateTime > 50){
    createHomeImage(e.clientX, e.clientY);
    lastCreateTime = now;
  }
});

// íƒ€ì´í•‘ íš¨ê³¼
function typeText(text, callback){
  if(isTyping) return;
  isTyping = true;
  
  subtitleText.innerHTML = "";
  let charIndex = 0;
  
  function typeChar(){
    if(charIndex < text.length){
      subtitleText.innerHTML = text.substring(0, charIndex + 1) + '<span id="typing-cursor"></span>';
      charIndex++;
      typingTimeout = setTimeout(typeChar, 50);
    } else {
      subtitleText.innerHTML = text;
      isTyping = false;
      if(callback) callback();
    }
  }
  
  typeChar();
}

// ì´ˆê¸° ë©”ì‹œì§€ í‘œì‹œ
setTimeout(() => {
  speakerLabel.classList.add("show");
  subtitleBox.classList.add("show");
  typeText(introMessages[0]);
}, 2100); // ê²€ì€ ì˜¤ë²„ë ˆì´ê°€ ì‚¬ë¼ì§„ í›„

// ìë§‰ë°” í´ë¦­ ì´ë²¤íŠ¸
subtitleBox.addEventListener("click", () => {
  if(isTyping){
    // íƒ€ì´í•‘ ì¤‘ì´ë©´ ì¦‰ì‹œ ì™„ì„±
    clearTimeout(typingTimeout);
    subtitleText.innerHTML = introMessages[introMessageIndex];
    isTyping = false;
    return;
  }
  
  introMessageIndex++;
  
  if(introMessageIndex < introMessages.length){
    // ë‹¤ìŒ ë©”ì‹œì§€ íƒ€ì´í•‘
    typeText(introMessages[introMessageIndex]);
  } else {
    // ì´ˆê¸° ë©”ì‹œì§€ ë, ì£¼ë¯¼ë“¤ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ
    subtitleBox.style.opacity = "0";
    speakerLabel.style.opacity = "0";
    errorOverlay.style.opacity = "0";
    setTimeout(() => {
      subtitleBox.style.pointerEvents = "none";
      speakerLabel.style.pointerEvents = "none";
      
      // ì¤‘ì•™ ì•ˆë‚´ ë¬¸êµ¬ í‘œì‹œ
      centerHint.classList.add("show");
      
      // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ê³  ì£¼ë¯¼ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ
      setTimeout(() => {
        centerHint.classList.remove("show");
        setTimeout(() => {
          canClickResidents = true;
          residentsContainer.classList.add("active");
          hint.style.opacity = "0.7";
          topHint.classList.add("show");
        }, 500);
      }, 3000);
    }, 300);
  }
});

residents.forEach((resident, index) => {
  const bubble = resident.querySelector(".speech-bubble");
  
  resident.addEventListener("click", () => {
    if(isInDialogue || !canClickResidents) return;
    
    topHint.style.opacity = "0";
    hint.style.opacity = "0";
    
    // í´ë¦­í•œ ì£¼ë¯¼ì˜ ì´ë¯¸ì§€ ì„¤ì • (talk ë²„ì „ ì‚¬ìš©)
    const clickedImg = resident.querySelector("img").src;
    // people1.png -> people1talk.pngë¡œ ë³€ê²½
    const talkImg = clickedImg.replace('.png', 'talk.png');
    dialoguePerson.src = talkImg;
    
    // ìŠ¤í”¼ì»¤ ì´ë¦„ ì„¤ì •
    dialogueSpeaker.textContent = speakerNames[index] || "ì£¼ë¯¼ 1";
    
    // í˜„ì¬ ì£¼ë¯¼ ì¸ë±ìŠ¤ì™€ ëŒ€í™” ì¸ë±ìŠ¤ ì´ˆê¸°í™”
    currentResidentIndex = index;
    currentDialogueIndex = 0;
    
    // ëŒ€í™” í™”ë©´ í‘œì‹œ
    setTimeout(() => {
      dialogueScene.classList.add("show");
      isInDialogue = true;
      
      // ì²« ë²ˆì§¸ ëŒ€í™” í‘œì‹œ
      const residentDialogues = dialogues[index] || dialogues[0];
      const firstMessage = Array.isArray(residentDialogues) ? residentDialogues[0] : residentDialogues;
      setTimeout(() => {
        typeDialogue(firstMessage);
      }, 300);
    }, 300);
    
    // í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (í•œ ë²ˆë§Œ ë“±ë¡)
    if(!dialogueScene.hasAttribute('data-listener-added')){
      dialogueScene.setAttribute('data-listener-added', 'true');
      dialogueScene.addEventListener("click", function nextDialogue(){
        // íƒ€ì´í•‘ ì¤‘ì´ë©´ ì¦‰ì‹œ ì™„ì„±
        if(isDialogueTyping){
          clearTimeout(dialogueTypingTimeout);
          const residentDialogues = dialogues[currentResidentIndex] || dialogues[0];
          const dialogueArray = Array.isArray(residentDialogues) ? residentDialogues : [residentDialogues];
          dialogueText.textContent = dialogueArray[currentDialogueIndex];
          isDialogueTyping = false;
          return;
        }
        
        const residentDialogues = dialogues[currentResidentIndex] || dialogues[0];
        const dialogueArray = Array.isArray(residentDialogues) ? residentDialogues : [residentDialogues];
        
        currentDialogueIndex++;
        
        if(currentDialogueIndex < dialogueArray.length){
          // ë‹¤ìŒ ëŒ€í™” í‘œì‹œ
          typeDialogue(dialogueArray[currentDialogueIndex]);
        } else {
          // í˜„ì¬ ì£¼ë¯¼ì˜ ëª¨ë“  ëŒ€í™” ë
          dialogueScene.classList.remove("show");
          dialogueIndex++;
          
          if(dialogueIndex < residents.length){
            setTimeout(() => {
              residentsContainer.style.opacity = "1";
              hint.style.opacity = "0.7";
              isInDialogue = false;
              currentResidentIndex = -1;
              currentDialogueIndex = 0;
            }, 500);
          } else {
            // ëª¨ë“  ëŒ€í™” ë - í…ìŠ¤íŠ¸ë°•ìŠ¤ ë‹¤ì‹œ í‘œì‹œ
            setTimeout(() => {
              residentsContainer.style.opacity = "0";
              hint.style.opacity = "0";
              topHint.style.opacity = "0";
              speakerLabel.style.opacity = "1";
              subtitleBox.style.opacity = "1";
              subtitleBox.style.pointerEvents = "auto";
              speakerLabel.style.pointerEvents = "auto";
              
              // "ë‹¤ë“¤ ìƒê°ë³´ë‹¤ ë‹¤ì •í•˜ë„¤.." íƒ€ì´í•‘
              introMessageIndex = 0;
              isTyping = false;
              typeText("ë‹¤ë“¤ ìƒê°ë³´ë‹¤ ë‹¤ì •í•˜ë„¤..", () => {
                // íƒ€ì´í•‘ ì™„ë£Œ í›„ doors.htmlë¡œ ì´ë™
                setTimeout(() => {
                  location.href = "doors.html";
                }, 2000);
              });
            }, 500);
          }
        }
      });
    }
  });
  
  resident.addEventListener("mouseenter", () => {
    if(!isInDialogue) bubble.classList.add("show");
  });
  
  resident.addEventListener("mouseleave", () => {
    bubble.classList.remove("show");
  });
});

// íƒ€ì´í•‘ íš¨ê³¼
function typeDialogue(text){
  if(isDialogueTyping) return;
  isDialogueTyping = true;
  
  dialogueText.textContent = "";
  let charIndex = 0;
  
  function typeChar(){
    if(charIndex < text.length){
      dialogueText.textContent = text.substring(0, charIndex + 1);
      charIndex++;
      dialogueTypingTimeout = setTimeout(typeChar, 50);
    } else {
      isDialogueTyping = false;
    }
  }
  
  typeChar();
}
</script>

</body>
</html>
